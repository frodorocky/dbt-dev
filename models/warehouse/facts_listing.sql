{{
    config(
        unique_key='listing_id'
    )
}}

with check_dimensions as
(select
	LISTING_ID,
	SCRAPE_ID,
	SCRAPED_DATE,
	HOST_ID,
	HOST_NAME,
	HOST_SINCE,
	HOST_IS_SUPERHOST,
	HOST_NEIGHBOURHOOD,
	case when UPPER(LISTING_NEIGHBOURHOOD) in (select distinct SUBURB_NAME from {{ ref('nsw_lga_suburb_stg') }}) then UPPER(LISTING_NEIGHBOURHOOD) else 'unkonwn' end as LISTING_NEIGHBOURHOOD,
	PROPERTY_TYPE,
	ROOM_TYPE,
	ACCOMMODATES,
	PRICE,
	HAS_AVAILABILITY,
	AVAILABILITY_30,
	NUMBER_OF_REVIEWS,
	REVIEW_SCORES_RATING,
	REVIEW_SCORES_ACCURACY,
	REVIEW_SCORES_CLEANLINESS,
	REVIEW_SCORES_CHECKIN,
	REVIEW_SCORES_COMMUNICATION,
	REVIEW_SCORES_VALUE,
	ingestion_datetime
from {{ ref('airbnb_listing_stg') }})

select
	a.*,
	b.LGA_NAME,
	c.LGA_CODE,
    g1.Tot_P_M,
	g1.Tot_P_F,
	g1.Tot_P_P,
	g1.Age_0_4_yr_M,
	g1.Age_0_4_yr_F,
	g1.Age_0_4_yr_P,
	g1.Age_5_14_yr_M,
	g1.Age_5_14_yr_F,
	g1.Age_5_14_yr_P,
	g1.Age_15_19_yr_M,
	g1.Age_15_19_yr_F,
	g1.Age_15_19_yr_P,
	g1.Age_20_24_yr_M,
	g1.Age_20_24_yr_F,
	g1.Age_20_24_yr_P,
	g1.Age_25_34_yr_M,
	g1.Age_25_34_yr_F,
	g1.Age_25_34_yr_P,
	g1.Age_35_44_yr_M,
	g1.Age_35_44_yr_F,
	g1.Age_35_44_yr_P,
	g1.Age_45_54_yr_M,
	g1.Age_45_54_yr_F,
	g1.Age_45_54_yr_P,
	g1.Age_55_64_yr_M,
	g1.Age_55_64_yr_F,
	g1.Age_55_64_yr_P,
	g1.Age_65_74_yr_M,
	g1.Age_65_74_yr_F,
	g1.Age_65_74_yr_P,
	g1.Age_75_84_yr_M,
	g1.Age_75_84_yr_F,
	g1.Age_75_84_yr_P,
	g1.Age_85ov_M,
	g1.Age_85ov_F,
	g1.Age_85ov_P,
	g1.Counted_Census_Night_home_M,
	g1.Counted_Census_Night_home_F,
	g1.Counted_Census_Night_home_P,
	g1.Count_Census_Nt_Ewhere_Aust_M,
	g1.Count_Census_Nt_Ewhere_Aust_F,
	g1.Count_Census_Nt_Ewhere_Aust_P,
	g1.Indigenous_psns_Aboriginal_M,
	g1.Indigenous_psns_Aboriginal_F,
	g1.Indigenous_psns_Aboriginal_P,
	g1.Indig_psns_Torres_Strait_Is_M,
	g1.Indig_psns_Torres_Strait_Is_F,
	g1.Indig_psns_Torres_Strait_Is_P,
	g1.Indig_Bth_Abor_Torres_St_Is_M,
	g1.Indig_Bth_Abor_Torres_St_Is_F,
	g1.Indig_Bth_Abor_Torres_St_Is_P,
	g1.Indigenous_P_Tot_M,
	g1.Indigenous_P_Tot_F,
	g1.Indigenous_P_Tot_P,
	g1.Birthplace_Australia_M,
	g1.Birthplace_Australia_F,
	g1.Birthplace_Australia_P,
	g1.Birthplace_Elsewhere_M,
	g1.Birthplace_Elsewhere_F,
	g1.Birthplace_Elsewhere_P,
	g1.Lang_spoken_home_Eng_only_M,
	g1.Lang_spoken_home_Eng_only_F,
	g1.Lang_spoken_home_Eng_only_P,
	g1.Lang_spoken_home_Oth_Lang_M,
	g1.Lang_spoken_home_Oth_Lang_F,
	g1.Lang_spoken_home_Oth_Lang_P,
	g1.Australian_citizen_M,
	g1.Australian_citizen_F,
	g1.Australian_citizen_P,
	g1.Age_psns_att_educ_inst_0_4_M,
	g1.Age_psns_att_educ_inst_0_4_F,
	g1.Age_psns_att_educ_inst_0_4_P,
	g1.Age_psns_att_educ_inst_5_14_M,
	g1.Age_psns_att_educ_inst_5_14_F,
	g1.Age_psns_att_educ_inst_5_14_P,
	g1.Age_psns_att_edu_inst_15_19_M,
	g1.Age_psns_att_edu_inst_15_19_F,
	g1.Age_psns_att_edu_inst_15_19_P,
	g1.Age_psns_att_edu_inst_20_24_M,
	g1.Age_psns_att_edu_inst_20_24_F,
	g1.Age_psns_att_edu_inst_20_24_P,
	g1.Age_psns_att_edu_inst_25_ov_M,
	g1.Age_psns_att_edu_inst_25_ov_F,
	g1.Age_psns_att_edu_inst_25_ov_P,
	g1.High_yr_schl_comp_Yr_12_eq_M,
	g1.High_yr_schl_comp_Yr_12_eq_F,
	g1.High_yr_schl_comp_Yr_12_eq_P,
	g1.High_yr_schl_comp_Yr_11_eq_M,
	g1.High_yr_schl_comp_Yr_11_eq_F,
	g1.High_yr_schl_comp_Yr_11_eq_P,
	g1.High_yr_schl_comp_Yr_10_eq_M,
	g1.High_yr_schl_comp_Yr_10_eq_F,
	g1.High_yr_schl_comp_Yr_10_eq_P,
	g1.High_yr_schl_comp_Yr_9_eq_M,
	g1.High_yr_schl_comp_Yr_9_eq_F,
	g1.High_yr_schl_comp_Yr_9_eq_P,
	g1.High_yr_schl_comp_Yr_8_belw_M,
	g1.High_yr_schl_comp_Yr_8_belw_F,
	g1.High_yr_schl_comp_Yr_8_belw_P,
	g1.High_yr_schl_comp_D_n_g_sch_M,
	g1.High_yr_schl_comp_D_n_g_sch_F,
	g1.High_yr_schl_comp_D_n_g_sch_P,
	g1.Count_psns_occ_priv_dwgs_M,
	g1.Count_psns_occ_priv_dwgs_F,
	g1.Count_psns_occ_priv_dwgs_P,
	g1.Count_Persons_other_dwgs_M,
	g1.Count_Persons_other_dwgs_F,
	g1.Count_Persons_other_dwgs_P,
    g2.Median_age_persons,
	g2.Median_mortgage_repay_monthly,
	g2.Median_tot_prsnl_inc_weekly,
	g2.Median_rent_weekly,
	g2.Median_tot_fam_inc_weekly,
	g2.Average_num_psns_per_bedroom,
	g2.Median_tot_hhd_inc_weekly,
	g2.Average_household_size
from check_dimensions a
LEFT JOIN nsw_lga_suburb_stg AS b ON UPPER(a.LISTING_NEIGHBOURHOOD) = b.SUBURB_NAME
LEFT JOIN nsw_lga_code_stg AS c ON b.LGA_NAME = c.LGA_NAME 
LEFT JOIN census_g01_nsw_lga_stg AS g1 ON c.LGA_CODE = g1.LGA_CODE
LEFT JOIN census_g02_nsw_lga_stg AS g2 ON c.LGA_CODE = g2.LGA_CODE



